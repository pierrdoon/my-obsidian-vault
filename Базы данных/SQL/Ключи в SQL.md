

Ключи в SQL — это специальные ограничения (constraints), которые определяют правила целостности данных и связи между таблицами. Они играют важную роль в проектировании баз данных. Разберем основные типы ключей и их назначение.

---

### **1. Первичный ключ (PRIMARY KEY)**
**Что это:**  
- Уникально идентифицирует каждую запись в таблице.  
- Не может содержать `NULL` значения.  
- В таблице может быть **только один** первичный ключ.  
- Автоматически создает **кластеризованный индекс** (в большинстве СУБД).

**Пример создания:**
```sql
CREATE TABLE users (
    id INT PRIMARY KEY,  -- Первичный ключ из одного столбца
    name VARCHAR(50)
);

-- Составной первичный ключ (из нескольких столбцов):
CREATE TABLE orders (
    user_id INT,
    order_id INT,
    PRIMARY KEY (user_id, order_id)
);
```

---

### **2. Внешний ключ (FOREIGN KEY)**
**Что это:**  
- Обеспечивает **ссылочную целостность** между таблицами.  
- Связывает поле в одной таблице с первичным ключом (или уникальным ключом) другой таблицы.  
- Позволяет задавать действия при удалении/обновлении связанных данных:
  - `ON DELETE CASCADE` — удалить связанные записи.
  - `ON DELETE SET NULL` — установить `NULL`.
  - `ON DELETE RESTRICT` — запретить удаление, если есть связанные данные.

**Пример:**
```sql
CREATE TABLE orders (
    order_id INT PRIMARY KEY,
    user_id INT,
    -- Внешний ключ, ссылающийся на users.id
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

---

### **3. Уникальный ключ (UNIQUE)**
**Что это:**  
- Гарантирует, что все значения в столбце (или комбинации столбцов) **уникальны**.  
- Может содержать `NULL` (но только один `NULL`, если это разрешено СУБД).  
- В таблице может быть несколько уникальных ключей.

**Пример:**
```sql
CREATE TABLE employees (
    id INT PRIMARY KEY,
    email VARCHAR(100) UNIQUE,  -- Уникальный email
    passport_number VARCHAR(20) UNIQUE
);
```

---

### **4. Естественные и суррогатные ключи**
- **Естественный ключ** — основан на реальных данных (например, `email`, `паспорт`).  
  **Плюсы:** Не требует дополнительных полей.  
  **Минусы:** Может меняться, что усложняет поддержку связей.

- **Суррогатный ключ** — искусственное поле (например, `id`).  
  **Плюсы:** Стабильность, простота использования.  
  **Минусы:** Добавляет избыточность.

---

### **5. Составные ключи**
Ключ, состоящий из нескольких столбцов. Используется, когда уникальность определяется комбинацией значений.  
**Пример:**
```sql
CREATE TABLE enrollments (
    student_id INT,
    course_id INT,
    PRIMARY KEY (student_id, course_id)  -- Составной первичный ключ
);
```

---

### **6. Разница между PRIMARY KEY, UNIQUE и INDEX**
- **PRIMARY KEY** — уникальный идентификатор + запрет на `NULL`.  
- **UNIQUE** — уникальность, но разрешен `NULL`.  
- **INDEX** — не является ключом, это структура для ускорения поиска.  
  Первичный и уникальный ключи автоматически создают индексы.

---

### **7. Примеры использования**
#### **Таблица с первичным и внешним ключом:**
```sql
CREATE TABLE authors (
    author_id INT PRIMARY KEY,
    name VARCHAR(100)
);

CREATE TABLE books (
    book_id INT PRIMARY KEY,
    title VARCHAR(200),
    author_id INT,
    FOREIGN KEY (author_id) REFERENCES authors(author_id)
);
```

#### **Таблица с уникальным ключом:**
```sql
CREATE TABLE products (
    product_id INT PRIMARY KEY,
    sku VARCHAR(50) UNIQUE,  -- Уникальный артикул
    price DECIMAL(10, 2)
);
```

---

### **8. Типичные ошибки**
- **Дубликаты в первичном ключе:**  
  ```sql
  INSERT INTO users (id, name) VALUES (1, 'Alice');
  INSERT INTO users (id, name) VALUES (1, 'Bob');  -- Ошибка!
  ```

- **Нарушение внешнего ключа:**  
  ```sql
  INSERT INTO orders (user_id) VALUES (999);  -- Если user_id=999 не существует в users
  ```

---

### **9. Важные замечания**
- **Производительность:** Ключи создают индексы, что ускоряет поиск, но замедляет вставку/обновление.
- **Именование:** Всегда давайте ключам понятные имена (например, `PK_users_id`, `FK_orders_users`).
- **Каскадные операции:** Используйте `ON DELETE CASCADE` аккуратно, чтобы не потерять данные.

---

Ключи — это фундамент целостности данных. Правильное их применение защищает от дубликатов, некорректных связей и упрощает работу с базой. Всегда анализируйте структуру данных перед выбором типа ключа!