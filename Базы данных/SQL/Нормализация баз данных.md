

**Нормализация баз данных** — это процесс организации данных в структуре, которая минимизирует избыточность, устраняет аномалии (ошибки при вставке, обновлении, удалении) и обеспечивает целостность данных. Она основана на разделении данных по таблицам и связывании их через ключи. Рассмотрим основные нормальные формы (НФ) и их применение.

---

### **1. Цели нормализации**
- **Устранение дублирования данных.**  
- **Предотвращение аномалий:**  
  - **Вставки:** Невозможность добавить данные без связанной информации.  
  - **Обновления:** Необходимость изменять данные в нескольких местах.  
  - **Удаления:** Потеря данных при удалении связанных записей.  
- **Упрощение поддержки и масштабирования БД.**

---

### **2. Нормальные формы**
#### **1НФ (Первая нормальная форма)**  
**Правило:** Все атрибуты таблицы должны быть **атомарными** (неделимыми), а в таблице не должно быть повторяющихся групп.  

**Пример нарушения 1НФ:**  
| `order_id` | `products`         |  
|------------|--------------------|  
| 1          | Молоко, Хлеб, Яйца |  

**Исправление (1НФ):**  
Создать отдельные строки для каждого продукта:  
| `order_id` | `product` |  
|------------|-----------|  
| 1          | Молоко    |  
| 1          | Хлеб      |  
| 1          | Яйца      |  

---

#### **2НФ (Вторая нормальная форма)**  
**Правило:**  
- Таблица должна быть в 1НФ.  
- Все неключевые атрибуты **полностью зависят от первичного ключа** (нет частичных зависимостей).  

**Пример нарушения 2НФ:**  
Таблица `orders`:  
| `order_id` (PK) | `product_id` (PK) | `product_name` | `customer_id` |  
|------------------|-------------------|----------------|---------------|  
| 1                | 101               | Молоко         | 5             |  

**Проблема:** `product_name` зависит только от `product_id`, а не от составного ключа `(order_id, product_id)`.  

**Исправление (2НФ):**  
Разделить таблицу на две:  
1. **order_items**:  
   | `order_id` | `product_id` | `customer_id` |  
   |------------|--------------|---------------|  
2. **products**:  
   | `product_id` | `product_name` |  
   |--------------|----------------|  

---

#### **3НФ (Третья нормальная форма)**  
**Правило:**  
- Таблица должна быть в 2НФ.  
- Нет **транзитивных зависимостей** (неключевые атрибуты не зависят от других неключевых атрибутов).  

**Пример нарушения 3НФ:**  
Таблица `employees`:  
| `employee_id` (PK) | `department_id` | `department_city` |  
|---------------------|-----------------|--------------------|  

**Проблема:** `department_city` зависит от `department_id`, а не напрямую от `employee_id`.  

**Исправление (3НФ):**  
Разделить таблицу:  
1. **employees**:  
   | `employee_id` | `department_id` |  
2. **departments**:  
   | `department_id` | `department_city` |  

---

#### **BCNF (Нормальная форма Бойса-Кодда)**  
**Правило:**  
- Каждая функциональная зависимость `X → Y` должна быть тривиальной (где `X` — суперключ).  
- Устраняет зависимости, когда ключ может быть определен через часть составного ключа.  

**Пример нарушения BCNF:**  
Таблица `courses`:  
| `student_id` | `course` | `professor` |  
|--------------|----------|-------------|  
**Предположим:**  
- Каждый курс ведет один профессор.  
- Студент может записаться на несколько курсов.  

**Проблема:** `professor` зависит от `course`, но `course` не является суперключом.  

**Исправление:**  
Создать таблицу **course_professor**:  
| `course` | `professor` |  

---

### **3. Преимущества и недостатки**
| **Преимущества**                          | **Недостатки**                          |  
|-------------------------------------------|-----------------------------------------|  
| Целостность данных                        | Усложнение структуры БД                 |  
| Устранение дублирования                   | Увеличение числа JOIN в запросах        |  
| Защита от аномалий                        | Риск избыточной нормализации            |  

---

### **4. Практические советы**
1. **Начинайте с 3НФ** для большинства проектов — это баланс между целостностью и производительностью.  
2. **Денормализуйте** данные, если нужна оптимизация для частых чтений (например, отчеты).  
3. **Используйте внешние ключи** для поддержки связей между таблицами.  
4. **Пример создания нормализованных таблиц:**  
   ```sql
   -- Таблица пользователей (3НФ)
   CREATE TABLE users (
       user_id INT PRIMARY KEY,
       name VARCHAR(100),
       email VARCHAR(100) UNIQUE
   );

   -- Таблица заказов
   CREATE TABLE orders (
       order_id INT PRIMARY KEY,
       user_id INT,
       order_date DATE,
       FOREIGN KEY (user_id) REFERENCES users(user_id)
   );

   -- Таблица товаров
   CREATE TABLE products (
       product_id INT PRIMARY KEY,
       product_name VARCHAR(200),
       price DECIMAL(10, 2)
   );

   -- Таблица связи заказов и товаров (для 2НФ)
   CREATE TABLE order_items (
       order_id INT,
       product_id INT,
       quantity INT,
       PRIMARY KEY (order_id, product_id),
       FOREIGN KEY (order_id) REFERENCES orders(order_id),
       FOREIGN KEY (product_id) REFERENCES products(product_id)
   );
   ```

---

### **5. Когда нарушать нормализацию?**
- **Высокочастотные запросы:** Если JOIN замедляет выборку, допустимо дублирование данных.  
- **Аналитика:** В хранилищах данных (Data Warehouse) часто используют денормализованные схемы (звезда, снежинка).  

---

Нормализация — это фундамент проектирования БД, но важно соблюдать баланс между теорией и практическими требованиями. Всегда тестируйте структуру на реальных сценариях!